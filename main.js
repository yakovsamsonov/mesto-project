(()=>{"use strict";var t=document.querySelector(".profile__avatar-box"),e=document.querySelector(".profile__avatar-image"),r=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-card-button"),o=document.querySelector(".elements"),c=document.querySelector(".profile__info"),a=document.querySelector(".profile__name"),i=document.querySelector(".profile__description"),u=document.querySelectorAll(".popup"),l=document.querySelector(".popup_type_edit-profile"),s=document.querySelector(".popup_type_add-card"),d=document.querySelector(".popup_type_edit-avatar"),f=document.querySelector(".popup_type_confirm-delete"),m=document.querySelector(".fullscreen-image"),p=m.querySelector(".fullscreen-image__picture"),v=m.querySelector(".fullscreen-image__label"),_=document.forms.profile,y=_.name,S=_.description,b=document.forms.card,q=b.label,E=b.link,h=document.forms.avatar,g=h["avatar-link"],L={formSelector:".form",fieldsetSelector:".form__fieldset",inputSelector:".form__input",submitButtonSelector:".form__action-button",inactiveButtonClass:"form__action-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"};function C(t,e,r){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(r.inactiveButtonClass),t.setAttribute("disabled",!0))}function k(t,e,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorPatternMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,r){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(t,e,r):function(t,e,r,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),o.classList.add(n.errorClass),o.textContent=r}(t,e,e.validationMessage,r)}function A(t){"Escape"==t.key&&document.querySelectorAll(".popup_opened").forEach(T)}function x(t){var e,r,n=t.querySelector(".form");n&&(e=n,r=L,Array.from(e.querySelectorAll(r.fieldsetSelector)).forEach((function(t){var e=Array.from(t.querySelectorAll(r.inputSelector));e.forEach((function(e){k(t,e,r)})),C(t.querySelector(r.submitButtonSelector),e,r)}))),document.addEventListener("keydown",A),t.classList.add("popup_opened")}function T(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function B(t){var e=t.target.querySelector(L.submitButtonSelector);e.classList.add(L.inactiveButtonClass),e.setAttribute("disabled",!0),t.target.reset(),T(t.target.closest(".popup"))}function P(t){f.dataset.cardId=t.target.closest(".card").dataset.cardId,x(f)}function I(t){var e=t.target.classList;(e.contains("popup__close-button")||e.contains("popup"))&&T(t.currentTarget)}var D,j="plus-cohort-22",w="2d446760-eb73-474d-999b-cb7f739e396a",H="https://mesto.nomoreparties.co";function M(t,e,r){return function(t,e,r){var n={method:e||"GET",headers:{authorization:w}};return r&&(n.body=JSON.stringify(r)),["PATCH","POST"].includes(e)&&(n.headers["Content-Type"]="application/json"),fetch("".concat(H,"/v1/").concat(j).concat(t),n)}(t,e,r).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function N(t,e){var r=t.querySelector(".card__like-button");!function(t){return t.some((function(t){return t._id===c.dataset.id}))}(e)?r.classList.remove("card__like-button_active"):r.classList.add("card__like-button_active"),r.dataset.likesCount=e.length}function O(t,e){var r=function(t){var e=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),r=e.querySelector(".card__item-photo"),n=e.querySelector(".card__item-label"),o=e.querySelector(".card__delete-button"),a=e.querySelector(".card__like-button");return e.dataset.cardId=t._id,c.dataset.id!==t.owner._id?o.remove():o.addEventListener("click",P),r.src=t.link,r.alt=t.name,n.textContent=t.name,N(e,t.likes),a.addEventListener("click",V),r.addEventListener("click",(function(){return e=t.link,r=t.name,p.src=e,p.alt=r,v.textContent=r,void x(m);var e,r})),e}(e);t.prepend(r)}function V(t){var e,r,n,o=t.target.closest(".card");(e=o.dataset.cardId,r=t.target.classList.contains("card__like-button_active"),n=r?"DELETE":"PUT",M("/cards/likes/".concat(e),n)).then((function(t){N(o,t.likes)})).catch((function(t){console.log(t)}))}function z(t){a.textContent=t.name,i.textContent=t.about,e.src=t.avatar,c.dataset.id=t._id}function G(t,e){var r=t.querySelector(L.submitButtonSelector),n=r.textContent;return r.textContent=e,n}r.addEventListener("click",(function(){y.value=a.textContent,S.value=i.textContent,x(l)})),n.addEventListener("click",(function(){x(s)})),t.addEventListener("click",(function(){x(d)})),u.forEach((function(t){t.addEventListener("click",I)})),b.addEventListener("submit",(function(t){t.preventDefault();var e,r,n,c=G(t.target,"Сохранение...");(e=q.value,r=E.value,n={},e&&(n.name=e),r&&(n.link=r),M("/cards","POST",n)).then((function(t){O(o,t)})).catch((function(t){console.log(t)})).finally((function(){B(t),G(t.target,c)}))})),_.addEventListener("submit",(function(t){t.preventDefault();var e,r,n,o=G(t.target,"Сохранение...");(e=y.value,r=S.value,n={},e&&(n.name=e),r&&(n.about=r),M("/users/me","PATCH",n)).then((function(t){z(t)})).catch((function(t){console.log(t)})).finally((function(){B(t),G(t.target,o)}))})),h.addEventListener("submit",(function(t){t.preventDefault();var e,r,n=G(t.target,"Сохранение...");(e=g.value,r={},e&&(r.avatar=e),M("/users/me/avatar","PATCH",r)).then((function(t){z(t)})).catch((function(t){console.log(t)})).finally((function(){B(t),G(t.target,n)}))})),f.querySelector(".form__action-button").addEventListener("click",(function(t){var e=f.dataset.cardId;(function(t){return M("/cards/".concat(t),"DELETE")})(e).then((function(){o.childNodes.forEach((function(t){e===t.dataset.cardId&&t.remove()}))})).catch((function(t){console.log(t)})).finally((function(){T(t.target.closest(".popup")),f.dataset.cardId=""}))})),Promise.all([M("/users/me"),M("/cards")]).then((function(t){z(t[0]),t[1].forEach((function(t){O(o,t)}))})).catch((function(t){console.log(t)})),D=L,Array.from(document.querySelectorAll(D.formSelector)).forEach((function(t){Array.from(t.querySelectorAll(D.fieldsetSelector)).forEach((function(t){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);C(n,r,e),r.forEach((function(o){o.addEventListener("input",(function(){k(t,o,e),C(n,r,e)}))}))}(t,D)}))}))})();