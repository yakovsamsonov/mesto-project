(()=>{"use strict";var e=document.querySelector(".profile__avatar-box"),t=document.querySelector(".profile__avatar-image"),n=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-card-button"),o=document.querySelector(".elements"),i=document.querySelector(".profile__info"),a=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),u=document.querySelectorAll(".popup"),l=document.querySelector(".popup_type_edit-profile"),s=document.querySelector(".popup_type_add-card"),d=document.querySelector(".popup_type_edit-avatar"),f=document.querySelector(".popup_type_confirm-delete"),m=document.querySelector(".fullscreen-image"),p=m.querySelector(".fullscreen-image__picture"),v=m.querySelector(".fullscreen-image__label"),_=document.forms.profile,y=_.name,h=_.description,b=document.forms.card,S=b.label,k=b.link,C=document.forms.avatar,g=C["avatar-link"],L={formSelector:".form",fieldsetSelector:".form__fieldset",inputSelector:".form__input",submitButtonSelector:".form__action-button",inactiveButtonClass:"form__action-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"};function E(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0))}function q(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function w(e,t){Array.from(e.querySelectorAll(t.fieldsetSelector)).forEach((function(e){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(n){q(e,n,t)})),E(e.querySelector(t.submitButtonSelector),n,t)}))}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==T(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===T(o)?o:String(o)),r)}var o}function P(e,t,n){return t&&A(e.prototype,t),n&&A(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var j=P((function e(t,n){var r=t.pressLike,o=t.deleteCard,i=t.openCard;B(this,e),this.pressLike=r,this.deleteCard=o,this.openCard=i,this.selector=n})),x=function(){function e(t,n){var r=t._id,o=t.name,i=t.link,a=t.likes,c=t.owner,u=n.pressLike,l=n.deleteCard,s=n.openCard,d=n.selector;B(this,e),this._selector=d,this._id=r,this._name=o,this._link=i,this._owner=c,this._setLikes(a),this._pressLike=u.bind(this),this._deleteCard=l.bind(this),this._openCard=s.bind(this)}return P(e,[{key:"element",get:function(){return this._element}},{key:"_setElement",value:function(){this._element=document.querySelector(this._selector).content.querySelector(".card").cloneNode(!0)}},{key:"createCard",value:function(e){this._setElement();var t=this._element.querySelector(".card__item-photo"),n=this._element.querySelector(".card__item-label"),r=this._element.querySelector(".card__delete-button");this._likeButton=this._element.querySelector(".card__like-button"),this._element.dataset.cardId=this._id,t.src=this._link,t.alt=this._name,n.textContent=this._name,this._owner._id===e?r.addEventListener("click",this._deleteCard):r.remove(),this.toggleLikeButton(this._likes,e),this._likeButton.addEventListener("click",this._pressLike),t.addEventListener("click",this._openCard)}},{key:"hasUserLike",value:function(e){return this._likes.some((function(t){return t._id===e}))}},{key:"toggleLikeButton",value:function(e,t){this._setLikes(e),this.hasUserLike(t)?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active"),this._likeButton.dataset.likesCount=this._likes.length}},{key:"getCardId",value:function(){return this._id}},{key:"_setLikes",value:function(e){this._likes=e}}]),e}();function I(e){a.textContent=e.name,c.textContent=e.about,t.src=e.avatar,i.dataset.id=e._id}function O(e){"Escape"==e.key&&document.querySelectorAll(".popup_opened").forEach(H)}function D(e){document.addEventListener("keydown",O),e.classList.add("popup_opened")}function H(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==M(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===M(o)?o:String(o)),r)}var o}var N=function(){function e(t){var n=t.renderer,r=t.container;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=r,this._renderer=n}var t,n;return t=e,(n=[{key:"addToStart",value:function(e){this._container.prepend(e)}},{key:"addToEnd",value:function(e){this._container.append(e)}},{key:"remove",value:function(e){this._container.childNodes.forEach((function(t){e===t.dataset.cardId&&t.remove()}))}},{key:"_clear",value:function(){this._container.innerHTML=""}},{key:"renderItems",value:function(e){var t=this;this._clear(),e.forEach((function(e){t._renderer(e)}))}}])&&U(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),V="plus-cohort-22",z="2d446760-eb73-474d-999b-cb7f739e396a",G="https://mesto.nomoreparties.co";function J(e,t,n){return function(e,t,n){var r={method:t||"GET",headers:{authorization:z}};return n&&(r.body=JSON.stringify(n)),["PATCH","POST"].includes(t)&&(r.headers["Content-Type"]="application/json"),fetch("".concat(G,"/v1/").concat(V).concat(e),r)}(e,t,n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function F(e){e.target.reset(),H(e.target.closest(".popup"))}function K(e){var t=e.target.classList;(t.contains("popup__close-button")||t.contains("popup"))&&H(e.currentTarget)}function Q(e,t){var n=e.querySelector(L.submitButtonSelector),r=n.textContent;return n.textContent=t,r}n.addEventListener("click",(function(){y.value=a.textContent,h.value=c.textContent;var e=l;w(e.querySelector(".form"),L),D(e)})),r.addEventListener("click",(function(){var e=s;w(e.querySelector(".form"),L),D(e)})),e.addEventListener("click",(function(){var e=d;w(e.querySelector(".form"),L),D(e)})),u.forEach((function(e){e.addEventListener("click",K)})),b.addEventListener("submit",(function(e){e.preventDefault();var t,n,r,o=Q(e.target,"Сохранение...");(t=S.value,n=k.value,r={},t&&(r.name=t),n&&(r.link=n),J("/cards","POST",r)).then((function(t){var n=new x(t,W);n.createCard(i.dataset.id),X.addToStart(n.element),F(e)})).catch((function(e){console.log(e)})).finally((function(){Q(e.target,o)}))})),_.addEventListener("submit",(function(e){e.preventDefault();var t,n,r,o=Q(e.target,"Сохранение...");(t=y.value,n=h.value,r={},t&&(r.name=t),n&&(r.about=n),J("/users/me","PATCH",r)).then((function(t){I(t),F(e)})).catch((function(e){console.log(e)})).finally((function(){Q(e.target,o)}))})),C.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=Q(e.target,"Сохранение...");(t=g.value,n={},t&&(n.avatar=t),J("/users/me/avatar","PATCH",n)).then((function(t){I(t),F(e)})).catch((function(e){console.log(e)})).finally((function(){Q(e.target,r)}))})),f.querySelector(".form__action-button").addEventListener("click",(function(e){var t=f.dataset.cardId;(function(e){return J("/cards/".concat(e),"DELETE")})(t).then((function(){X.remove(t),H(e.target.closest(".popup")),f.dataset.cardId=""})).catch((function(e){console.log(e)}))}));var R,W=new j({pressLike:function(){var e,t,n,r=this;(e=this.getCardId(),t=this.hasUserLike(i.dataset.id),n=t?"DELETE":"PUT",J("/cards/likes/".concat(e),n)).then((function(e){r.toggleLikeButton(e.likes,i.dataset.id)})).catch((function(e){console.log(e)}))},deleteCard:function(){var e=f;e.dataset.cardId=this._id,D(e)},openCard:function(){p.src=this._link,p.alt=this._name,v.textContent=this._name,D(m)}},"#card-template"),X=new N({renderer:function(e){var t=new x(e,W);t.createCard(i.dataset.id),X.addToEnd(t.element)},container:o});Promise.all([J("/users/me"),J("/cards")]).then((function(e){I(e[0]),X.renderItems(e[1])})).catch((function(e){console.log(e)})),R=L,Array.from(document.querySelectorAll(R.formSelector)).forEach((function(e){Array.from(e.querySelectorAll(R.fieldsetSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);E(r,n,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorPatternMessage):t.setCustomValidity(""),t.validity.valid?q(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(e,t,t.validationMessage,n)}(e,o,t),E(r,n,t)}))}))}(e,R)}))}))})();