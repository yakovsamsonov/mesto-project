(()=>{"use strict";var e=document.querySelector(".profile__avatar-box"),t=document.querySelector(".profile__avatar-image"),r=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-card-button"),o=document.querySelector(".elements"),c=document.querySelector(".profile__info"),a=document.querySelector(".profile__name"),i=document.querySelector(".profile__description"),u=document.querySelectorAll(".popup"),l=document.querySelector(".popup_type_edit-profile"),s=document.querySelector(".popup_type_add-card"),d=document.querySelector(".popup_type_edit-avatar"),f=document.querySelector(".popup_type_confirm-delete"),m=document.querySelector(".fullscreen-image"),p=m.querySelector(".fullscreen-image__picture"),v=m.querySelector(".fullscreen-image__label"),_=document.forms.profile,y=_.name,S=_.description,q=document.forms.card,b=q.label,E=q.link,h=document.forms.avatar,g=h["avatar-link"],L={formSelector:".form",fieldsetSelector:".form__fieldset",inputSelector:".form__input",submitButtonSelector:".form__action-button",inactiveButtonClass:"form__action-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"};function k(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.classList.remove(r.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(r.inactiveButtonClass),e.setAttribute("disabled",!0))}function C(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorPatternMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass),o.textContent=r}(e,t,t.validationMessage,r)}function A(e,t){Array.from(e.querySelectorAll(t.fieldsetSelector)).forEach((function(e){var r=Array.from(e.querySelectorAll(t.inputSelector));r.forEach((function(r){C(e,r,t)})),k(e.querySelector(t.submitButtonSelector),r,t)}))}var x,T="plus-cohort-22",P="2d446760-eb73-474d-999b-cb7f739e396a",B="https://mesto.nomoreparties.co";function I(e,t,r){return function(e,t,r){var n={method:t||"GET",headers:{authorization:P}};return r&&(n.body=JSON.stringify(r)),["PATCH","POST"].includes(t)&&(n.headers["Content-Type"]="application/json"),fetch("".concat(B,"/v1/").concat(T).concat(e),n)}(e,t,r).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function D(e){"Escape"==e.key&&document.querySelectorAll(".popup_opened").forEach(w)}function j(e){document.addEventListener("keydown",D),e.classList.add("popup_opened")}function w(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",D)}function H(e){var t=f;t.dataset.cardId=e.target.closest(".card").dataset.cardId,j(t)}function M(e,t){var r=e.querySelector(".card__like-button");!function(e){return e.some((function(e){return e._id===c.dataset.id}))}(t)?r.classList.remove("card__like-button_active"):r.classList.add("card__like-button_active"),r.dataset.likesCount=t.length}function N(e,t){var r=function(e){var t=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__item-photo"),n=t.querySelector(".card__item-label"),o=t.querySelector(".card__delete-button"),a=t.querySelector(".card__like-button");return t.dataset.cardId=e._id,c.dataset.id!==e.owner._id?o.remove():o.addEventListener("click",H),r.src=e.link,r.alt=e.name,n.textContent=e.name,M(t,e.likes),a.addEventListener("click",O),r.addEventListener("click",(function(){return t=e.link,r=e.name,p.src=t,p.alt=r,v.textContent=r,void j(m);var t,r})),t}(t);e.prepend(r)}function O(e){var t,r,n,o=e.target.closest(".card");(t=o.dataset.cardId,r=e.target.classList.contains("card__like-button_active"),n=r?"DELETE":"PUT",I("/cards/likes/".concat(t),n)).then((function(e){M(o,e.likes)})).catch((function(e){console.log(e)}))}function V(e){a.textContent=e.name,i.textContent=e.about,t.src=e.avatar,c.dataset.id=e._id}function z(e){e.target.reset(),w(e.target.closest(".popup"))}function G(e){var t=e.target.classList;(t.contains("popup__close-button")||t.contains("popup"))&&w(e.currentTarget)}function J(e,t){var r=e.querySelector(L.submitButtonSelector),n=r.textContent;return r.textContent=t,n}r.addEventListener("click",(function(){y.value=a.textContent,S.value=i.textContent;var e=l;A(e.querySelector(".form"),L),j(e)})),n.addEventListener("click",(function(){var e=s;A(e.querySelector(".form"),L),j(e)})),e.addEventListener("click",(function(){var e=d;A(e.querySelector(".form"),L),j(e)})),u.forEach((function(e){e.addEventListener("click",G)})),q.addEventListener("submit",(function(e){e.preventDefault();var t,r,n,c=J(e.target,"Сохранение...");(t=b.value,r=E.value,n={},t&&(n.name=t),r&&(n.link=r),I("/cards","POST",n)).then((function(t){N(o,t),z(e)})).catch((function(e){console.log(e)})).finally((function(){J(e.target,c)}))})),_.addEventListener("submit",(function(e){e.preventDefault();var t,r,n,o=J(e.target,"Сохранение...");(t=y.value,r=S.value,n={},t&&(n.name=t),r&&(n.about=r),I("/users/me","PATCH",n)).then((function(t){V(t),z(e)})).catch((function(e){console.log(e)})).finally((function(){J(e.target,o)}))})),h.addEventListener("submit",(function(e){e.preventDefault();var t,r,n=J(e.target,"Сохранение...");(t=g.value,r={},t&&(r.avatar=t),I("/users/me/avatar","PATCH",r)).then((function(t){V(t),z(e)})).catch((function(e){console.log(e)})).finally((function(){J(e.target,n)}))})),f.querySelector(".form__action-button").addEventListener("click",(function(e){var t=f.dataset.cardId;(function(e){return I("/cards/".concat(e),"DELETE")})(t).then((function(){o.childNodes.forEach((function(e){t===e.dataset.cardId&&e.remove()})),w(e.target.closest(".popup")),f.dataset.cardId=""})).catch((function(e){console.log(e)}))})),Promise.all([I("/users/me"),I("/cards")]).then((function(e){V(e[0]),e[1].forEach((function(e){N(o,e)}))})).catch((function(e){console.log(e)})),x=L,Array.from(document.querySelectorAll(x.formSelector)).forEach((function(e){Array.from(e.querySelectorAll(x.fieldsetSelector)).forEach((function(e){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);k(n,r,t),r.forEach((function(o){o.addEventListener("input",(function(){C(e,o,t),k(n,r,t)}))}))}(e,x)}))}))})();